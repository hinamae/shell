#!/bin/bash

#7桁の数値が書かれたファイルの3桁目と4桁目の間にハイフンを入れたり、ハイフン付きの7桁の数値からハイフンを削除して表示する


#ハイフンを削除するがどうかのフラグ

#１ならば削除する

d_flag=0

#getoptsコマンドで削除オプション(-d)指定を判別

while getopts "d" option
do
	case $option in
		d)
			d_flag=1
			;;
		\?)
			exit 1
			;;
	esac
done

#コマンドライン引数で指定された郵便番号ファイルをシェル変数filenameに代入する
#OPTINDはシェル変数
#OPTIND=次に処理するパラメータの位置変数
#OPTINDから１を引いた数でshift変数を用いることによって、オプション部分を無視した本当のコマンドライン引数を順番に、$1,$2...と扱えるようになる
#慣用句のようなもの。
shift $(expr $OPTIND - 1)
filename="$1"

#指定された郵便番号ファイルの存在チェック
if [ ! -f "$filename" ]; then
	
	echo "対象のファイルが存在しません:$filename" >&2
	exit 1
fi


#dflagが指定されていればハイフンを削除、指定がなけれハイフン追加
if [ "$d_flag" -eq 1 ]; then
	#ハイフンを削除する
	#awkで前後スペース除去→フォーマットチェック→ハイフン削除
	#^=文字列の先頭
	#$文字列の最後
	awk '{print $1}' "$filename" | grep '^[0-9]\{3\}-[0-9]\{4\}$' | sed "s/-//"
else
	#*ハイフンを付加する
	#awkで前後スペース除去→フォーマットチェック→ハイフンを付加
	awk '{print $1}' "$filename" | grep '^[0-9]\{7\}$' | sed "s/\(...\)/\1-/"
fi

